<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colonia Espacial Incremental</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0F0F23 0%, #1A1A3A 50%, #2D2D5F 100%);
            min-height: 100vh;
            color: #E0E0FF;
            overflow-x: auto;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            color: #00FFFF;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            animation: title-glow 3s ease-in-out infinite alternate;
        }

        @keyframes title-glow {
            0% { text-shadow: 0 0 20px rgba(0, 255, 255, 0.5); }
            100% { text-shadow: 0 0 30px rgba(0, 255, 255, 0.8), 0 0 40px rgba(0, 255, 255, 0.3); }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: 2px solid #00FFFF;
            border-radius: 30px;
            background: linear-gradient(45deg, rgba(0, 255, 255, 0.1), rgba(0, 255, 255, 0.3));
            color: #00FFFF;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            backdrop-filter: blur(10px);
        }

        button:hover {
            background: linear-gradient(45deg, rgba(0, 255, 255, 0.3), rgba(0, 255, 255, 0.5));
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
            transform: translateY(-3px);
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(138, 43, 226, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stat-label {
            font-size: 12px;
            color: #A0A0FF;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00FFFF;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .colony-view {
            background: radial-gradient(circle at center, #1A1A3A 0%, #0F0F23 70%);
            border: 2px solid #00FFFF;
            border-radius: 20px;
            padding: 30px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .space-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, #FFF, transparent),
                radial-gradient(2px 2px at 40% 70%, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90% 40%, #FFF, transparent),
                radial-gradient(1px 1px at 50% 50%, rgba(255,255,255,0.6), transparent);
            animation: stars-twinkle 4s ease-in-out infinite alternate;
        }

        @keyframes stars-twinkle {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .planet {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle at 30% 30%, #FF6B6B, #8B4513);
            border-radius: 50%;
            box-shadow: 
                0 0 50px rgba(255, 107, 107, 0.3),
                inset -20px -20px 50px rgba(0, 0, 0, 0.5);
        }

        .buildings {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .building {
            background: linear-gradient(180deg, #4A90E2, #2E5984);
            border: 1px solid #00FFFF;
            border-radius: 5px 5px 0 0;
            position: relative;
            animation: building-glow 2s ease-in-out infinite alternate;
        }

        @keyframes building-glow {
            0% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.3); }
            100% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.6); }
        }

        .building::after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 15px;
            background: #FF0000;
            box-shadow: 0 0 10px #FF0000;
            animation: antenna-blink 1s infinite;
        }

        @keyframes antenna-blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-section {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(138, 43, 226, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel-title {
            color: #00FFFF;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .session-log {
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .session-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            border-left: 3px solid #00FFFF;
        }

        .session-active {
            border-left-color: #00FF00;
            background: rgba(0, 255, 0, 0.1);
        }

        .time-display {
            background: rgba(0, 0, 0, 0.7);
            color: #00FFFF;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.5);
        }

        .achievements-grid {
            display: grid;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .achievement {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            font-size: 12px;
            position: relative;
            transition: all 0.3s ease;
        }

        .achievement.completed {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.2), rgba(0, 200, 0, 0.1));
            border-color: #00FF00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .achievement.completed::before {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 8px;
            color: #00FF00;
            font-weight: bold;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: bold;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .notification.show {
            transform: translateX(0);
        }

        .upgrade-panel {
            display: grid;
            gap: 10px;
        }

        .upgrade-btn {
            padding: 10px;
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.2));
            border: 1px solid rgba(255, 215, 0, 0.5);
            border-radius: 8px;
            color: #FFD700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .upgrade-btn:hover:not(.disabled) {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.2), rgba(255, 140, 0, 0.3));
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .upgrade-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        button.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .resources {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .resource {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #00FFFF rgba(0, 0, 0, 0.3);
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: #00FFFF;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">🚀 COLONIA ESPACIAL NEXUS 🌌</h1>
            <div class="time-display" id="timeDisplay">Sistema en espera - Inicializar colonia</div>
        </div>

        <div class="controls">
            <button id="startBtn" onclick="startGame()">🚀 INICIAR COLONIA</button>
            <button id="stopBtn" onclick="stopGame()" class="disabled">⏹️ DETENER</button>
            <button onclick="toggleSessionLog()">📊 VER REGISTROS</button>
        </div>

        <div class="main-layout">
            <div class="left-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Población</div>
                        <div class="stat-value" id="population">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Energía</div>
                        <div class="stat-value" id="energy">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Minerales</div>
                        <div class="stat-value" id="minerals">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Investigación</div>
                        <div class="stat-value" id="research">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Tiempo Activo</div>
                        <div class="stat-value" id="activeTime">00:00:00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Eficiencia</div>
                        <div class="stat-value" id="efficiency">100%</div>
                    </div>
                </div>

                <div class="colony-view">
                    <div class="space-bg"></div>
                    <div class="planet"></div>
                    <div class="buildings" id="buildings">
                        <!-- Los edificios se generarán dinámicamente -->
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="panel-section">
                    <div class="panel-title">📊 Registros de Sesión</div>
                    <div class="session-log scrollbar" id="sessionLog">
                        <div class="session-entry">
                            Sistema inicializado - Esperando activación
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-title">⚡ Mejoras</div>
                    <div class="upgrade-panel" id="upgradePanel">
                        <!-- Las mejoras se generarán dinámicamente -->
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-title">🏆 Logros Galácticos</div>
                    <div class="achievements-grid scrollbar" id="achievementGrid">
                        <!-- Los logros se generarán dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let gameState = {
            isRunning: false,
            startTime: null,
            endTime: null,
            population: 1,
            energy: 10,
            minerals: 5,
            research: 0,
            buildings: 1,
            efficiency: 1.0,
            upgrades: {
                energyGenerator: 0,
                miningDrill: 0,
                researchLab: 0,
                habitatModule: 0,
                solarArray: 0,
                quantumComputer: 0
            },
            achievements: [],
            sessionHistory: [],
            totalPlayTime: 0,
            dailyPlayTime: {},
            consecutiveDays: 0,
            lastPlayDate: null
        };

        let gameInterval;
        let timeInterval;
        let saveInterval;

        const achievementsList = [
            // Día 1-3: Primeros pasos
            { id: 1, title: "Primera Colonia", description: "Alcanza 10 población", target: 10, type: "population", completed: false },
            { id: 2, title: "Operario Espacial", description: "Mantén activa la colonia 30 minutos", target: 1800, type: "time", completed: false },
            { id: 3, title: "Minero Novato", description: "Acumula 100 minerales", target: 100, type: "minerals", completed: false },
            { id: 4, title: "Central Energética", description: "Alcanza 500 energía", target: 500, type: "energy", completed: false },
            
            // Día 4-7: Desarrollo temprano
            { id: 5, title: "Investigador Espacial", description: "Acumula 50 investigación", target: 50, type: "research", completed: false },
            { id: 6, title: "Comandante Dedicado", description: "Mantén activa la colonia 2 horas", target: 7200, type: "time", completed: false },
            { id: 7, title: "Asentamiento", description: "Alcanza 100 población", target: 100, type: "population", completed: false },
            { id: 8, title: "Minero Experto", description: "Acumula 1,000 minerales", target: 1000, type: "minerals", completed: false },
            
            // Semana 2: Expansión
            { id: 9, title: "Reactor Avanzado", description: "Alcanza 5,000 energía", target: 5000, type: "energy", completed: false },
            { id: 10, title: "Científico Veterano", description: "Acumula 200 investigación", target: 200, type: "research", completed: false },
            { id: 11, title: "Maratonista Espacial", description: "Mantén activa la colonia 4 horas", target: 14400, type: "time", completed: false },
            { id: 12, title: "Ciudad Espacial", description: "Alcanza 500 población", target: 500, type: "population", completed: false },
            
            // Semana 2-3: Crecimiento sostenido
            { id: 13, title: "Magnate Minero", description: "Acumula 10,000 minerales", target: 10000, type: "minerals", completed: false },
            { id: 14, title: "Planta de Fusión", description: "Alcanza 25,000 energía", target: 25000, type: "energy", completed: false },
            { id: 15, title: "Genio Científico", description: "Acumula 500 investigación", target: 500, type: "research", completed: false },
            { id: 16, title: "Comandante Élite", description: "Mantén activa la colonia 6 horas", target: 21600, type: "time", completed: false },
            
            // Semana 3-4: Potencia máxima
            { id: 17, title: "Metrópolis Galáctica", description: "Alcanza 2,000 población", target: 2000, type: "population", completed: false },
            { id: 18, title: "Emperador Minero", description: "Acumula 50,000 minerales", target: 50000, type: "minerals", completed: false },
            { id: 19, title: "Maestro de la Energía", description: "Alcanza 100,000 energía", target: 100000, type: "energy", completed: false },
            { id: 20, title: "Sabio Cuántico", description: "Acumula 1,000 investigación", target: 1000, type: "research", completed: false },
            
            // Semana 4: Objetivos finales
            { id: 21, title: "Señor del Tiempo", description: "Mantén activa la colonia 8 horas", target: 28800, type: "time", completed: false },
            { id: 22, title: "Imperio Galáctico", description: "Alcanza 10,000 población", target: 10000, type: "population", completed: false },
            { id: 23, title: "Dios de los Minerales", description: "Acumula 200,000 minerales", target: 200000, type: "minerals", completed: false },
            { id: 24, title: "Reactor Estelar", description: "Alcanza 500,000 energía", target: 500000, type: "energy", completed: false },
            { id: 25, title: "Mente Superior", description: "Acumula 5,000 investigación", target: 5000, type: "research", completed: false },
            
            // Logros de dedicación (días totales)
            { id: 26, title: "Veterano de Guerra", description: "Juega 20 horas totales", target: 72000, type: "totalTime", completed: false },
            { id: 27, title: "Maestro del Universo", description: "Juega 50 horas totales", target: 180000, type: "totalTime", completed: false },
            { id: 28, title: "Dios Espacial", description: "Juega 100 horas totales", target: 360000, type: "totalTime", completed: false },
            
            // Logros de consistencia
            { id: 29, title: "Disciplinado", description: "Completa 7 días seguidos (6h/día)", target: 7, type: "consecutive", completed: false },
            { id: 30, title: "Dedicado", description: "Completa 15 días seguidos (6h/día)", target: 15, type: "consecutive", completed: false },
            { id: 31, title: "Leyenda", description: "Completa 30 días seguidos (6h/día)", target: 30, type: "consecutive", completed: false },
            
            // Logros de eficiencia
            { id: 32, title: "Optimizador", description: "Alcanza 200% eficiencia", target: 2.0, type: "efficiency", completed: false },
            { id: 33, title: "Perfeccionista", description: "Alcanza 500% eficiencia", target: 5.0, type: "efficiency", completed: false },
            { id: 34, title: "Trascendente", description: "Alcanza 1000% eficiencia", target: 10.0, type: "efficiency", completed: false }
        ];

        const upgradesList = [
            { 
                id: "energyGenerator", 
                name: "Generador de Energía", 
                cost: { minerals: 20, energy: 0 }, 
                effect: "Aumenta producción de energía", 
                multiplier: 1.5 
            },
            { 
                id: "miningDrill", 
                name: "Perforador Minero", 
                cost: { minerals: 0, energy: 30 }, 
                effect: "Aumenta extracción de minerales", 
                multiplier: 1.4 
            },
            { 
                id: "habitatModule", 
                name: "Módulo de Hábitat", 
                cost: { minerals: 50, energy: 25 }, 
                effect: "Aumenta crecimiento poblacional", 
                multiplier: 1.3 
            },
            { 
                id: "researchLab", 
                name: "Laboratorio", 
                cost: { minerals: 100, energy: 75 }, 
                effect: "Aumenta velocidad investigación", 
                multiplier: 2.0 
            },
            { 
                id: "solarArray", 
                name: "Array Solar", 
                cost: { minerals: 200, energy: 0, research: 25 }, 
                effect: "Generación energía masiva", 
                multiplier: 3.0 
            },
            { 
                id: "quantumComputer", 
                name: "Computadora Cuántica", 
                cost: { minerals: 500, energy: 300, research: 100 }, 
                effect: "Boost total eficiencia", 
                multiplier: 2.5 
            }
        ];

        // Inicializar el estado de botones al cargar
        function initializeGame() {
            gameState.achievements = [...achievementsList];
            loadGameData();
            updateAchievementDisplay();
            updateUpgradeDisplay();
            updateDisplay();
            loadSessionHistory();
            
            // Configurar estado inicial de botones
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (gameState.isRunning) {
                startBtn.classList.add('disabled');
                stopBtn.classList.remove('disabled');
                
                // Reiniciar intervalos si el juego estaba corriendo
                gameInterval = setInterval(gameTick, 500);
                timeInterval = setInterval(updateTimeDisplay, 1000);
                saveInterval = setInterval(saveGameData, 30000);
            } else {
                startBtn.classList.remove('disabled');
                stopBtn.classList.add('disabled');
            }
        }

        function saveGameData() {
            const saveData = {
                ...gameState,
                lastSave: Date.now()
            };
            // En un entorno real, esto se guardaría en localStorage
            // pero aquí lo mantenemos en memoria durante la sesión
            window.gameData = saveData;
        }

        function loadGameData() {
            if (window.gameData) {
                const savedData = window.gameData;
                Object.assign(gameState, savedData);
                
                // Calcular progreso offline si había una sesión guardada
                if (savedData.lastSave && savedData.isRunning) {
                    const offlineTime = (Date.now() - savedData.lastSave) / 1000;
                    if (offlineTime > 30) { // Más de 30 segundos offline
                        processOfflineProgress(offlineTime);
                    }
                }
            }
        }

        function processOfflineProgress(seconds) {
            const offlineGains = calculateResourceGains(seconds);
            gameState.population += Math.floor(offlineGains.population);
            gameState.energy += Math.floor(offlineGains.energy);
            gameState.minerals += Math.floor(offlineGains.minerals);
            gameState.research += Math.floor(offlineGains.research);
            
            showNotification(`🚀 Progreso offline: +${Math.floor(offlineGains.population)} población, +${Math.floor(offlineGains.energy)} energía`);
        }

        function startGame() {
            if (gameState.isRunning) return;
            
            gameState.isRunning = true;
            gameState.startTime = new Date();
            
            // Actualizar botones
            document.getElementById('startBtn').classList.add('disabled');
            document.getElementById('stopBtn').classList.remove('disabled');
            
            addSessionEntry("🚀 COLONIA ACTIVADA", "session-active");
            showNotification("🚀 ¡Colonia espacial iniciada! Los sistemas están en línea...");
            
            gameInterval = setInterval(gameTick, 500);
            timeInterval = setInterval(updateTimeDisplay, 1000);
            saveInterval = setInterval(saveGameData, 30000);
            
            updateDisplay();
        }

        function stopGame() {
            if (!gameState.isRunning) return;
            
            gameState.isRunning = false;
            gameState.endTime = new Date();
            
            // Actualizar botones
            document.getElementById('startBtn').classList.remove('disabled');
            document.getElementById('stopBtn').classList.add('disabled');
            
            // Guardar esta sesión en el historial
            const sessionDuration = Math.floor((gameState.endTime - gameState.startTime) / 1000);
            gameState.totalPlayTime += sessionDuration;
            
            // Trackear tiempo diario
            const today = new Date().toDateString();
            if (!gameState.dailyPlayTime[today]) {
                gameState.dailyPlayTime[today] = 0;
            }
            gameState.dailyPlayTime[today] += sessionDuration;
            
            // Actualizar días consecutivos
            updateConsecutiveDays();
            
            const sessionRecord = {
                start: gameState.startTime.toLocaleString('es-ES'),
                end: gameState.endTime.toLocaleString('es-ES'),
                duration: formatTime(sessionDuration),
                populationGained: Math.floor(gameState.population / 10),
                day: gameState.startTime.toLocaleDateString('es-ES'),
                dailyTotal: formatTime(gameState.dailyPlayTime[today])
            };
            
            gameState.sessionHistory.unshift(sessionRecord);
            if (gameState.sessionHistory.length > 100) {
                gameState.sessionHistory = gameState.sessionHistory.slice(0, 100);
            }
            
            clearInterval(gameInterval);
            clearInterval(timeInterval);
            clearInterval(saveInterval);
            
            addSessionEntry("⏹️ COLONIA DETENIDA");
            
            // Mostrar automáticamente el registro de tiempo
            showTimeReport(sessionRecord);
            
            updateTimeDisplay();
            saveGameData();
        }

        function gameTick() {
            if (!gameState.isRunning) return;
            
            const gains = calculateResourceGains(0.5); // Para 0.5 segundos
            
            gameState.population += gains.population;
            gameState.energy += gains.energy;
            gameState.minerals += gains.minerals;
            gameState.research += gains.research;
            
            // Limitar recursos para evitar desbordamiento
            gameState.population = Math.min(gameState.population, 999999);
            gameState.energy = Math.min(gameState.energy, 999999);
            gameState.minerals = Math.min(gameState.minerals, 999999);
            gameState.research = Math.min(gameState.research, 999999);
            
            updateDisplay();
            updateBuildings();
            checkAchievements();
        }

        function calculateResourceGains(deltaSeconds) {
            const baseRates = {
                population: 0.02,
                energy: 0.5,
                minerals: 0.3,
                research: 0.05
            };
            
            let multiplier = gameState.efficiency;
            
            // Aplicar bonificaciones de mejoras
            const energyBonus = Math.pow(upgradesList[0].multiplier, gameState.upgrades.energyGenerator);
            const miningBonus = Math.pow(upgradesList[1].multiplier, gameState.upgrades.miningDrill);
            const habitatBonus = Math.pow(upgradesList[2].multiplier, gameState.upgrades.habitatModule);
            const researchBonus = Math.pow(upgradesList[3].multiplier, gameState.upgrades.researchLab);
            const solarBonus = Math.pow(upgradesList[4].multiplier, gameState.upgrades.solarArray);
            const quantumBonus = Math.pow(upgradesList[5].multiplier, gameState.upgrades.quantumComputer);
            
            return {
                population: baseRates.population * deltaSeconds * multiplier * habitatBonus * quantumBonus,
                energy: baseRates.energy * deltaSeconds * multiplier * energyBonus * solarBonus * quantumBonus,
                minerals: baseRates.minerals * deltaSeconds * multiplier * miningBonus * quantumBonus,
                research: baseRates.research * deltaSeconds * multiplier * researchBonus * quantumBonus
            };
        }

        function updateDisplay() {
            document.getElementById('population').textContent = Math.floor(gameState.population).toLocaleString();
            document.getElementById('energy').textContent = Math.floor(gameState.energy).toLocaleString();
            document.getElementById('minerals').textContent = Math.floor(gameState.minerals).toLocaleString();
            document.getElementById('research').textContent = Math.floor(gameState.research).toLocaleString();
            document.getElementById('efficiency').textContent = `${Math.floor(gameState.efficiency * 100)}%`;
            
            updateUpgradeDisplay();
        }

        function updateBuildings() {
            const buildingsContainer = document.getElementById('buildings');
            const targetBuildings = Math.min(Math.floor(gameState.population / 10) + 1, 15);
            
            if (gameState.buildings < targetBuildings) {
                const newBuilding = document.createElement('div');
                newBuilding.className = 'building';
                const height = 30 + Math.random() * 40;
                const width = 15 + Math.random() * 10;
                newBuilding.style.height = `${height}px`;
                newBuilding.style.width = `${width}px`;
                buildingsContainer.appendChild(newBuilding);
                gameState.buildings++;
            }
        }

        function updateTimeDisplay() {
            const timeDisplay = document.getElementById('timeDisplay');
            const activeTimeElement = document.getElementById('activeTime');
            
            if (gameState.isRunning && gameState.startTime) {
                const now = new Date();
                const elapsed = Math.floor((now - gameState.startTime) / 1000);
                const timeStr = formatTime(elapsed);
                
                activeTimeElement.textContent = timeStr;
                
                const startStr = gameState.startTime.toLocaleString('es-ES');
                timeDisplay.textContent = `SESIÓN ACTIVA - Iniciada: ${startStr} | Tiempo: ${timeStr}`;
            } else if (gameState.endTime) {
                const startStr = gameState.startTime.toLocaleString('es-ES');
                const endStr = gameState.endTime.toLocaleString('es-ES');
                const totalTime = Math.floor((gameState.endTime - gameState.startTime) / 1000);
                const timeStr = formatTime(totalTime);
                
                timeDisplay.textContent = `ÚLTIMA SESIÓN: ${startStr} - ${endStr} | Duración: ${timeStr}`;
                activeTimeElement.textContent = formatTime(gameState.totalPlayTime);
            } else {
                activeTimeElement.textContent = formatTime(gameState.totalPlayTime);
            }
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function checkAchievements() {
            gameState.achievements.forEach(achievement => {
                if (achievement.completed) return;
                
                let targetMet = false;
                let currentValue = 0;
                
                switch (achievement.type) {
                    case 'population':
                        currentValue = gameState.population;
                        break;
                    case 'energy':
                        currentValue = gameState.energy;
                        break;
                    case 'minerals':
                        currentValue = gameState.minerals;
                        break;
                    case 'research':
                        currentValue = gameState.research;
                        break;
                    case 'time':
                        if (gameState.isRunning && gameState.startTime) {
                            currentValue = Math.floor((Date.now() - gameState.startTime) / 1000);
                        }
                        break;
                    case 'totalTime':
                        currentValue = gameState.totalPlayTime;
                        break;
                    case 'consecutive':
                        currentValue = gameState.consecutiveDays;
                        break;
                    case 'efficiency':
                        currentValue = gameState.efficiency;
                        break;
                }
                
                targetMet = currentValue >= achievement.target;
                
                if (targetMet) {
                    achievement.completed = true;
                    showNotification(`🏆 ¡LOGRO DESBLOQUEADO! ${achievement.title}`);
                    addSessionEntry(`🏆 Logro: ${achievement.title}`);
                    updateAchievementDisplay();
                }
            });
        }

        function updateAchievementDisplay() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            gameState.achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${achievement.completed ? 'completed' : ''}`;
                achievementElement.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 3px;">${achievement.title}</div>
                    <div style="font-size: 11px; opacity: 0.8;">${achievement.description}</div>
                `;
                grid.appendChild(achievementElement);
            });
        }

        function updateUpgradeDisplay() {
            const panel = document.getElementById('upgradePanel');
            panel.innerHTML = '';
            
            upgradesList.forEach(upgrade => {
                const level = gameState.upgrades[upgrade.id];
                const cost = calculateUpgradeCost(upgrade, level);
                const canAfford = canAffordUpgrade(cost);
                
                const upgradeElement = document.createElement('div');
                upgradeElement.className = `upgrade-btn ${canAfford ? '' : 'disabled'}`;
                upgradeElement.innerHTML = `
                    <div style="font-weight: bold;">${upgrade.name} Lv.${level}</div>
                    <div style="font-size: 10px; opacity: 0.8; margin: 2px 0;">${upgrade.effect}</div>
                    <div style="font-size: 10px;">Costo: ${formatCost(cost)}</div>
                `;
                
                if (canAfford) {
                    upgradeElement.onclick = () => purchaseUpgrade(upgrade.id);
                }
                
                panel.appendChild(upgradeElement);
            });
        }

        function calculateUpgradeCost(upgrade, level) {
            const multiplier = Math.pow(1.5, level);
            const cost = {};
            
            Object.entries(upgrade.cost).forEach(([resource, baseCost]) => {
                cost[resource] = Math.floor(baseCost * multiplier);
            });
            
            return cost;
        }

        function canAffordUpgrade(cost) {
            return Object.entries(cost).every(([resource, amount]) => {
                switch (resource) {
                    case 'minerals': return gameState.minerals >= amount;
                    case 'energy': return gameState.energy >= amount;
                    case 'research': return gameState.research >= amount;
                    default: return false;
                }
            });
        }

        function formatCost(cost) {
            return Object.entries(cost)
                .map(([resource, amount]) => `${amount} ${resource}`)
                .join(', ');
        }

        function purchaseUpgrade(upgradeId) {
            const upgrade = upgradesList.find(u => u.id === upgradeId);
            const level = gameState.upgrades[upgradeId];
            const cost = calculateUpgradeCost(upgrade, level);
            
            if (!canAffordUpgrade(cost)) return;
            
            // Deducir costos
            Object.entries(cost).forEach(([resource, amount]) => {
                switch (resource) {
                    case 'minerals': gameState.minerals -= amount; break;
                    case 'energy': gameState.energy -= amount; break;
                    case 'research': gameState.research -= amount; break;
                }
            });
            
            gameState.upgrades[upgradeId]++;
            
            // Aplicar efectos especiales
            if (upgradeId === 'quantumComputer') {
                gameState.efficiency += 0.1;
            }
            
            showNotification(`⚡ ${upgrade.name} mejorado al nivel ${gameState.upgrades[upgradeId]}!`);
            addSessionEntry(`⚡ Mejora: ${upgrade.name} Lv.${gameState.upgrades[upgradeId]}`);
            
            updateDisplay();
        }

        function showTimeReport(sessionRecord) {
            const today = new Date().toDateString();
            const dailyTime = gameState.dailyPlayTime[today] || 0;
            const dailyHours = (dailyTime / 3600).toFixed(1);
            const totalHours = (gameState.totalPlayTime / 3600).toFixed(1);
            const dailyGoalProgress = Math.min((dailyTime / 21600) * 100, 100).toFixed(1); // 6 horas = 21600 segundos
            
            const report = `
                📊 REPORTE DE SESIÓN COMPLETADA<br><br>
                🕐 Sesión: ${sessionRecord.duration}<br>
                📅 Hoy total: ${formatTime(dailyTime)} (${dailyHours}h)<br>
                🎯 Meta diaria: ${dailyGoalProgress}% (6h objetivo)<br>
                ⏱️ Tiempo total: ${formatTime(gameState.totalPlayTime)} (${totalHours}h)<br>
                🔥 Días consecutivos: ${gameState.consecutiveDays}<br>
                👥 Población actual: ${Math.floor(gameState.population).toLocaleString()}<br><br>
                ${dailyTime >= 21600 ? '🎉 ¡META DIARIA COMPLETADA!' : `⏰ Necesitas ${formatTime(21600 - dailyTime)} más para completar el día`}
            `;
            
            addSessionEntry(report, "session-active");
            showNotification(`⏹️ Sesión completada! Jugaste ${sessionRecord.duration} hoy.`);
        }

        function updateConsecutiveDays() {
            const today = new Date().toDateString();
            const todayTime = gameState.dailyPlayTime[today] || 0;
            
            if (todayTime >= 21600) { // 6 horas completadas hoy
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toDateString();
                
                if (gameState.lastPlayDate === yesterdayStr || gameState.lastPlayDate === null) {
                    if (gameState.lastPlayDate !== today) {
                        gameState.consecutiveDays++;
                    }
                } else {
                    gameState.consecutiveDays = 1; // Reset si no jugó ayer
                }
                
                gameState.lastPlayDate = today;
            }
        }

        function addSessionEntry(message, className = '') {
            const log = document.getElementById('sessionLog');
            const entry = document.createElement('div');
            entry.className = `session-entry ${className}`;
            entry.innerHTML = `
                <div style="font-size: 10px; opacity: 0.7;">${new Date().toLocaleTimeString('es-ES')}</div>
                <div>${message}</div>
            `;
            
            log.insertBefore(entry, log.firstChild);
            
            // Limitar entradas del log
            while (log.children.length > 100) {
                log.removeChild(log.lastChild);
            }
        }

        function loadSessionHistory() {
            if (gameState.sessionHistory.length === 0) return;
            
            gameState.sessionHistory.forEach(session => {
                addSessionEntry(
                    `📊 SESIÓN: ${session.start} - ${session.end}<br>
                     ⏱️ Duración: ${session.duration} | Total día: ${session.dailyTotal || 'N/A'}<br>
                     👥 +${session.populationGained} población`
                );
            });
        }

        function toggleSessionLog() {
            const log = document.getElementById('sessionLog');
            log.innerHTML = '';
            
            if (gameState.sessionHistory.length > 0) {
                // Mostrar resumen general simple
                const totalSessions = gameState.sessionHistory.length;
                const totalHours = (gameState.totalPlayTime / 3600).toFixed(1);
                
                addSessionEntry(`
                    📊 RESUMEN TOTAL<br>
                    🎮 Sesiones: ${totalSessions} | ⏱️ Tiempo total: ${totalHours}h
                `, 'session-active');
                
                // Mostrar solo los registros de sesiones
                gameState.sessionHistory.forEach((session, index) => {
                    addSessionEntry(`
                        📅 ${session.day}<br>
                        🕐 Inicio: ${session.start.split(' ')[1]}<br>
                        🕑 Fin: ${session.end.split(' ')[1]}<br>
                        ⏱️ Duración: ${session.duration}
                    `);
                });
            } else {
                addSessionEntry("📊 No hay registros de sesiones disponibles");
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.innerHTML = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Auto-save más frecuente para no perder progreso
        setInterval(() => {
            if (gameState.isRunning) {
                saveGameData();
            }
        }, 10000); // Cada 10 segundos

        // Manejar cierre de ventana para guardar
        window.addEventListener('beforeunload', () => {
            saveGameData();
        });

        // Inicializar el juego al cargar la página
        initializeGame();
    </script>
</body>
</html>